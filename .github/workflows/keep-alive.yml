name: Keep Supabase Alive

on:
  schedule:
    # Se ejecuta a las 8:00 AM UTC todos los d√≠as
    - cron: '0 8 * * *'
  workflow_dispatch:  # Permite ejecutar manualmente desde la pesta√±a Actions

jobs:
  ping-supabase:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Supabase to prevent pausing
        run: |
          echo "üîÑ Ejecutando keep-alive para Supabase..."
          echo "üìÖ Fecha y hora: $(date -u '+%Y-%m-%d %H:%M:%S UTC')"
          echo ""
          
          response=$(curl -s -w "\nHTTP_STATUS:%{http_code}" -X GET \
            "${{ secrets.SUPABASE_URL }}/rest/v1/inscripcions?select=id&limit=1" \
            -H "apikey: ${{ secrets.SUPABASE_ANON_KEY }}" \
            -H "Authorization: Bearer ${{ secrets.SUPABASE_ANON_KEY }}")
          
          http_status=$(echo "$response" | grep "HTTP_STATUS" | cut -d: -f2)
          body=$(echo "$response" | sed '/HTTP_STATUS/d')
          
          echo "üì° Respuesta recibida:"
          echo "$body" | jq '.' || echo "$body"
          echo ""
          echo "‚úÖ Estado HTTP: $http_status"
          
          if [ "$http_status" -eq 200 ]; then
            echo "‚úÖ Keep-alive ejecutado correctamente. Supabase est√° activo."
          else
            echo "‚ö†Ô∏è  Respuesta inesperada (HTTP $http_status). Verifica la configuraci√≥n."
            exit 1
          fi
        continue-on-error: true  # Contin√∫a aunque haya error para no romper el workflow

